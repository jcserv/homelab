# Power Monitor Configuration

# Container image settings
image:
  repository: power-monitor # TODO: Build and push to registry
  tag: "1.0.0"
  pullPolicy: IfNotPresent

# ServiceAccount configuration
serviceAccount:
  name: power-monitor

# Critical node that never shuts down (runs Home Assistant + Zigbee)
criticalNode: pi4-02

# Home Assistant configuration
homeAssistant:
  # URL to Home Assistant API (use localhost since we're on same node)
  url: "http://localhost:8123"

  # Home Assistant Long-Lived Access Token
  # Generate this in Home Assistant:
  #   1. Go to your profile (click your name in sidebar)
  #   2. Scroll to "Long-Lived Access Tokens"
  #   3. Click "Create Token"
  #   4. Give it a name like "Power Monitor"
  #   5. Copy the token and paste it here
  token: "YOUR_HOME_ASSISTANT_TOKEN_HERE"

  # Power sensor entity ID
  powerSensor: "sensor.smart_plug_power"

# Monitoring configuration
monitoring:
  # How often to poll Home Assistant API (seconds)
  pollInterval: 15

# Shutdown sequence configuration
shutdown:
  # Nodes to shutdown first (have hard drives or are most critical to protect)
  priorityNodes:
    - pi5-01

  # Nodes to shutdown second (standard nodes)
  secondaryNodes:
    - pi4-01
    - pi5-02

  # Time delays (seconds)
  # At 45W load, UPS runtime is ~15-20 minutes
  # Conservative timeline to ensure shutdown completes:

  # Delay before shutting down priority nodes (default: 3 minutes)
  # Timeline: T+30s cordon, T+1min drain, T+3min shutdown
  priorityDelay: 180

  # Delay before shutting down secondary nodes (default: 7 minutes)
  secondaryDelay: 420

# SSH configuration for node shutdowns
ssh:
  # SSH user that has sudo access on all nodes
  user: "jarrodservilla"

  # SSH private key for passwordless authentication
  # Paste your private key here (the content of ~/.ssh/id_rsa or similar)
  # Example:
  # privateKey: |
  #   -----BEGIN OPENSSH PRIVATE KEY-----
  #   b3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAAAABAAABlwAAAAdzc2gtcn
  #   ...
  #   -----END OPENSSH PRIVATE KEY-----
  privateKey: ""

# Network configuration
hostNetwork: true
dnsPolicy: ClusterFirstWithHostNet

# Resource limits
resources:
  requests:
    memory: "64Mi"
    cpu: "50m"
  limits:
    memory: "128Mi"
    cpu: "200m"
