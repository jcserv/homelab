hub:
  enabled: true
  replicaCount: 1

  image:
    repository: henrygd/beszel
    tag: "latest"
    pullPolicy: IfNotPresent

  resources:
    requests:
      memory: "64Mi"
      cpu: "50m"
    limits:
      memory: "100Mi"
      cpu: "200m"

  storage:
    data:
      storageClass: local-path
      size: 1Gi

  service:
    type: ClusterIP
    port: 8090
    # Uncomment for direct LoadBalancer access (without ingress)
    # type: LoadBalancer
    # loadBalancerIP: 10.0.0.201
    # annotations:
    #   metallb.universe.tf/allow-shared-ip: beszel

  # Ingress configuration for HTTPS access via beszel.home
  ingress:
    enabled: true
    className: nginx
    host: beszel.home
    tlsSecretName: wildcard-home-tls
    annotations:
      nginx.ingress.kubernetes.io/ssl-redirect: "true"

  # Prefer pi4-01, but allow scheduling on other nodes if unavailable
  affinity:
    nodeAffinity:
      preferredDuringSchedulingIgnoredDuringExecution:
        - weight: 100
          preference:
            matchExpressions:
              - key: kubernetes.io/hostname
                operator: In
                values:
                  - pi4-01

agent:
  enabled: true
  # Deploy individual agents per node for unique credentials
  deploymentType: PerNode

  image:
    repository: henrygd/beszel-agent
    tag: "latest"
    pullPolicy: IfNotPresent

  resources:
    requests:
      memory: "32Mi"
      cpu: "25m"
    limits:
      memory: "64Mi"
      cpu: "100m"

  # Agent configuration
  port: 45876
  hubUrl: "http://beszel:8090"

  # Authentication method: "universal" or "individual"
  # - universal: All agents use the same token and key (auto-registration)
  # - individual: Each agent has unique credentials (manual setup required)
  authMode: "universal"

  # Universal token authentication (when authMode: "universal")
  # Get token from beszel hub: /settings/tokens
  # Get key from beszel hub: /api/beszel/getkey (requires authentication)
  universal:
    # Note: These should be stored in sealed secrets
    # key: "ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIOFjX/xhD+Y/8JqYu/x6J2m/LRf0g2KodgRghSB5bALP"
    # token: "be3719b6-9255-492d-a542-d64cac27a6b4"

  # Per-node agent configurations (when authMode: "individual")
  nodes:
    - name: pi4-01
      hostname: pi4-01
      # key: "ssh-ed25519 XYZ"
      # token: "XYZ"
    - name: pi4-02
      hostname: pi4-02
      # key: "ssh-ed25519 XYZ"
      # token: "XYZ"
    - name: pi5-01
      hostname: pi5-01
      # key: "ssh-ed25519 XYZ"
      # token: "XYZ"

  hostNetwork: true

  volumes:
    dockerSocket: false
    extraFilesystems: []
