{{- /*
Pi-hole Nebula Sync Credentials - Fallback Plain Secret
*/ -}}
{{- if and .Values.nebulaSync.enabled (or .Values.nebulaSync.primaryPassword .Values.nebulaSync.replicaPassword) }}
{{- $replicas := list }}
{{- range $i := until (int .Values.replicaCount) }}
  {{- if ne $i 0 }}
    {{- $replicas = append $replicas (printf "http://%s-%d.%s-headless:80|%s" (include "pihole.fullname" $) $i (include "pihole.fullname" $) $.Values.nebulaSync.replicaPassword) }}
  {{- end }}
{{- end }}
apiVersion: v1
kind: Secret
metadata:
  name: {{ include "pihole.fullname" . }}-nebula-sync
  labels:
    app: {{ include "pihole.name" . }}
  annotations:
    pihole/secret-type: "fallback"
type: Opaque
stringData:
  PRIMARY: "http://{{ include "pihole.fullname" . }}-0.{{ include "pihole.fullname" . }}-headless:80|{{ .Values.nebulaSync.primaryPassword }}"
  REPLICAS: "{{ join "," $replicas }}"
{{- end }}
